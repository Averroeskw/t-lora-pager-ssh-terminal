; PlatformIO Configuration for LilyGo T-LoRa Pager Terminal Client
; ================================================================
; Uses LilyGoLib for hardware initialization
;
; Build: pio run
; Upload: pio run --target upload

[platformio]
src_dir = tlorapager_terminal
boards_dir = ./boards

[env:t-lora-pager]
platform = espressif32@6.10.0
board = lilygo-t-lora-pager
framework = arduino

; Upload settings
upload_speed = 115200
monitor_speed = 115200
upload_protocol = esptool
upload_flags =
    --before=default_reset
    --after=hard_reset
    --no-stub

; Filesystem and partitions
; LittleFS for XML config files (uploadfs command: pio run -t uploadfs)
board_build.filesystem = littlefs
board_build.partitions = partitions_custom.csv

; Build flags
build_flags =
    -D CORE_DEBUG_LEVEL=1
    -D ARDUINO_T_LORA_PAGER
    -I variants/lilygo_tlora_pager
    -Wnarrowing

    ; LoRa radio selection (SX1262)
    -D ARDUINO_LILYGO_LORA_SX1262

    ; Exclude unused RadioLib modules
    -D RADIOLIB_EXCLUDE_RF69
    -D RADIOLIB_EXCLUDE_SX1231
    -D RADIOLIB_EXCLUDE_RFM2X
    -D RADIOLIB_EXCLUDE_SX127X
    -D RADIOLIB_EXCLUDE_AFSK
    -D RADIOLIB_EXCLUDE_AX25
    -D RADIOLIB_EXCLUDE_HELLSCHREIBER
    -D RADIOLIB_EXCLUDE_MORSE
    -D RADIOLIB_EXCLUDE_RTTY
    -D RADIOLIB_EXCLUDE_SSTV
    -D RADIOLIB_EXCLUDE_DIRECT_RECEIVE
    -D RADIOLIB_EXCLUDE_APRS
    -D RADIOLIB_EXCLUDE_BELL

    ; LVGL configuration - use LilyGoLib's lv_conf.h
    -D LV_CONF_INCLUDE_SIMPLE
    -I .pio/libdeps/t-lora-pager/LilyGoLib/src

    ; TCA8418 keyboard library
    -I ".pio/libdeps/t-lora-pager/Adafruit TCA8418"
    -I ".pio/libdeps/t-lora-pager/Adafruit BusIO"

    ; NFC libraries
    -I .pio/libdeps/t-lora-pager/NFC-RFAL-fork/src
    -I .pio/libdeps/t-lora-pager/ST25R3916-fork/src

    ; Force WiFi library includes
    -I/Users/averroes/.platformio/packages/framework-arduinoespressif32/libraries/WiFi/src
    -I/Users/averroes/.platformio/packages/framework-arduinoespressif32/libraries/WiFiClientSecure/src

    ; Terminal configuration
    -D TERMINAL_COLS=80
    -D TERMINAL_ROWS=20

    ; WebSockets debug disabled (too verbose)
    -D NODEBUG_WEBSOCKETS

; Monitor filters
monitor_filters =
    default
    esp32_exception_decoder

; Library dependencies (matching k257)
lib_deps =
    ; Core LilyGo library for hardware init
    https://github.com/Xinyuan-LilyGO/LilyGoLib

    ; WiFiClientSecure (must be explicit for WebSockets SSL)
    WiFiClientSecure

    ; LVGL for display
    lvgl/lvgl @ ^9.4.0

    ; Radio
    jgromes/RadioLib @ ^7.4.0

    ; Power and sensors
    lewisxhe/XPowersLib@^0.3.1
    lewisxhe/SensorLib @ ^0.3.3

    ; GPS (required by LilyGoLib)
    mikalhart/TinyGPSPlus @ ^1.0.3

    ; Keyboard
    adafruit/Adafruit TCA8418 @ ^1.0.2
    adafruit/Adafruit BusIO @ ^1.17.0

    ; NFC (required by LilyGoLib)
    https://github.com/lewisxhe/ST25R3916-fork.git
    https://github.com/lewisxhe/NFC-RFAL-fork.git

    ; SSH client library
    ewpa/LibSSH-ESP32 @ ^5.0.0

    ; JSON parsing (keep for settings)
    bblanchon/ArduinoJson @ ^7.0.0

    ; TinyXML2 for XML config parsing
    bblanchon/TinyXML2 @ ^10.0.0

; Library settings
lib_ldf_mode = chain+
lib_compat_mode = soft
